spring:
    application:
        name: Kaleo

    #Database configuration
    datasource:
        url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost/postgres}
        username: ${POSTGRES_USER}
        password: ${POSTGRES_PASSWORD}

    #JPA Configuration
    jpa:
        hibernate:
            ddl-auto: update
        show-sql: ${SHOW_SQL:false}
        properties:
            hibernate:
                format_sql: true
                dialect: org.hibernate.dialect.PostgreSQLDialect

    #Spring Security - JWT validation (container-to-container)
    security:
        oauth2:
            resourceserver:
                jwt:
                    # Use JWK set URI for key fetching (container can reach keycloak:8080)
                    jwk-set-uri: ${KEYCLOAK_JWK_SET_URI:http://localhost:9095/realms/kaleo-events/protocol/openid-connect/certs}
                    # Accept tokens issued by the browser-accessible URL
                    issuer-uri: ${KEYCLOAK_BROWSER_URL:http://localhost:9095/realms/kaleo-events}

    threads:
        virtual:
            enabled: true

server:
    port: ${SERVER_PORT:8080}

# Keycloak browser-accessible URL for Swagger OAuth (NOT the container URL)
keycloak:
    browser-url: ${KEYCLOAK_BROWSER_URL:http://localhost:9095/realms/kaleo-events}

# SpringDoc / Swagger UI configuration
springdoc:
    swagger-ui:
        oauth:
            client-id: ${SWAGGER_OAUTH_CLIENT_ID:kaleo-event-app}
            use-pkce-with-authorization-code-grant: true
        oauth2-redirect-url: ${SWAGGER_OAUTH2_REDIRECT_URL:http://localhost:8081/swagger-ui/oauth2-redirect.html}
    api-docs:
        path: /v3/api-docs